---
title: 如何设计一个好的API及其重要性
date: 2023-11-06 20:00:00 +0800
categories: [权衡质量与务实, 抽象]
tags: [抽象, API设计]     # TAG names should always be lowercase
toc: true
---

本文是 **How to Design a Good API and Why it Matters** 的中文翻译版。



《如何设计一个好的API及其重要性》 作者：约书亚 布洛赫，前谷歌首席软件工程师



## 为什么API设计重要？

* API 可以成为公司最重要的资产之一
  * 客户大量投资：购买、写作、学习
  * 停止使用 API 的成本可能令人望而却步
  * 成功的公共 API 吸引客户 
* 也可能是公司最大的负债之一
  * 差劲的 API 导致了无休止的支持呼叫
* 公开的 API 是永恒的 - 一次做对的机会

## 为什么API设计对你很重要

* 如果你编程，你就是一个API的设计者
  * 好的代码是模块化的-每个模块有一个API
* 有用的模块往往能复用
  * 一旦模块有了用户，不能再修改API
  * 好的可重用模块是企业资产
* 从 API 角度思考可提高代码质量

## 一个优秀 API 的特点

* 易学
* 易使用，甚至没有文档
* 很难误使用
* 使用它的代码易于阅读和维护
* 足够强大，满足要求
* 易扩展
* 适合观众

## 大纲

* API设计的流程
* 一般原则
* 类设计
* 方法设计
* 异常设计
* 重构API设计

## API设计的流程

### 收集需求—以健康的方式怀疑程度

* 通常您会得到建议的解决方案
  * 好的解决方案也许已经存在
* 你的工作就是提取真正的需求
  * 应采用用例的形式
* 构建更一般的东西可能更容易、更有价值

### 从简短的规格开始 ，1 页是理想的选择

* 在这个阶段，敏捷性胜过完整性
* 让尽可能多的人了解规格
  * 倾听他们的意见并认真对待
* 如果你保持短的规格，很容易修改
* 当你获得自信时，充实它
  * 这必然涉及到编码

### 尽早并经常写入您的 API

* 在实施 API 之前开始
  * 节省您执行将被丢弃的实施工作
*  在正确指定之前就开始
  * 使您无需编写将被丢弃的规格
* 充实 API 后继续写入 API
  _ 防止令人讨厌的意外
  _ 代码作为示例、单元测试继续存在

### 写入 SPI 更为重要

* 服务提供接口（SPI）
* 发布之前编写多个插件
  * 如果写一个，可能不会支持另一个
  * 如果写两个，就很难支持更多了
  * 如果写三个，工作良好
* 威尔·特拉兹（Will Tracz）称之为“三分法则”

###  保持现实的期望

* 大多数 API 设计都受到过度约束
  * 你无法取悦所有人
  * 旨在让每个人都同 样不高兴
* 预计会犯错误
  * 几年的实际使用将把它们冲走
  *  期待 API 的发展

## 一般原则

### API应该只做一件事，并且把它做好

* 功能应该易于解释
  * 如果很难命名，这通常是一个坏兆头
  * 好名字推动发展
  * 能够拆分和合并模块

### API 应尽可能小，但是不更小
* API 应满足其要求
*  如有疑问，请忽略它
  * 功能、类、方法、参数等。
  * 你可以随时添加，但永远不能删除
  * 概念重量比体积更重要
  * 寻求良好的功率重量比

### 实现不应该影响API

* 实施细节
  * 迷惑用户
  * 抑制改变实施的自由
* 了解什么是实施细节
  * 不要过度指定方法的行为
  * 例如：不指定哈希函数
  * 所有调整参数都是可疑的
* 不要让实施细节“泄漏”到 API 中
  * 磁盘上和线上格式，例外



### 尽量减少一切的可访问性

* 使类和成员尽可能私密
* 公共类不应有公共字段（常量除外）
*  这最大化了信息隐藏
* 允许使用、理解、构建模块，独立测试、调试



### 名称很重要—API 是一门小语言

* 名称应该基本上是不言自明的

  * 避免使用晦涩难懂的缩写

*  保持一致—同一个词意味着同样的事情

  * 整个 API，（跨平台上的 API）

* 保持规律——力求对称

* 代码读起来应该像散文一样，比如：

  > **if (car.speed() > 2 \* SPEED_LIMIT)**
  >
  >  **generateAlert("Watch out for cops!");**



## 类设计

## 方法设计

## 异常设计

## 重构API设计
